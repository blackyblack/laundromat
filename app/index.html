<!DOCTYPE html>
<html dir="ltr" lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->

  <title>Laundromat</title>
  
<!-- Bootstrap, via a CDN -->
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

<!-- Superhero Bootstrap theme -->
<link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/superhero/bootstrap.min.css" rel="stylesheet" integrity="sha384-Xqcy5ttufkC3rBa8EdiAyA1VgOGrmel2Y+wxm4K3kI3fcjTWlDWrlnxyD6hOi3PF" crossorigin="anonymous">

<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>

<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- End Bootstrap -->

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

<style type="text/css" media="screen">
@media screen {
    .badge_large {
        display: inline-block;
        min-width: 10px;
        padding: 3px 20px;
        font-size: 18px;
        font-weight: 500;
        color: #ffffff;
        line-height: 1;
        vertical-align: middle;
        white-space: nowrap;
        text-align: center;
        background-color: #616161;
        border-radius: 5px;
    }
}</style>
</head>

<script>

function statusCallback(data) {

  var web3 = new Web3();

  if(data.result != 'ok') {
    document.getElementById('queryStatusLabel').innerHTML = 'Error: ' + data.error;
    return;
  }

  console.log(data.participants);
  document.getElementById('queryStatusLabel').innerHTML = 'Status: Success';
  document.getElementById('participants').innerHTML = data.participants;
  document.getElementById('gotParticipants').innerHTML = data.gotParticipants;
  document.getElementById('payment').innerHTML = web3.fromWei(data.payment, 'ether');
}

function generatePrivate() {

  var key = random_key();
  document.getElementById('privateResult').value = key.toString();
  verifyTest();
}

function verifyTest() {

  var privateKey = '24883375667666319798130594789127643442423595702572623965227685575198986951784';
  var myaddress = '0x4460f4c8edBcA96f9dB17ef95AAF329eDdaeac29';
  var publicKeys = [
    ['23503456097056075834787824699565082974248719863748670453930416475016722867598',
     '12029010276117245204134325384098229702769917839541508121640700015551410501619'],
    ['52043104733337935592382440027801835398034545360665484397010150219950554448238',
     '85487817269951599375113881092901317364959242010982485618000922284759361444548']
  ];

  /*var result = signring(privateKey, myaddress, publicKeys);
  console.log(result);*/

  var signature = [
    '42607646753486226685999488335176415688000154994211705391966234827367658580771',
    '60917276817684258092788765868947350825139617657862020575008772132097571635984'];
  var x0 = '20847553301175380169296461108324294551141732374791259350302891202179875646585';
  var Ix = '93198480408494617772116109893865793529438843888349347776259093746725432304418';
  var Iy = '63298093260563983748339219613947152348598835318642613695636196807095653173075';
  /*var signature = result.signature;
  var x0 = result.x0;
  var Ix = result.ix;
  var Iy = result.iy; */
  var result = verifyring(signature, x0, Ix, Iy, myaddress, publicKeys);
  console.log(result);
}

function depositStart() {
  document.getElementById('depositLabel').innerHTML = 'Pending';
  deposit(document.getElementById('address2').value,document.getElementById('myaddress').value, document.getElementById('privatekey').value, depositCallback);
}

function depositCallback(data) {

  if(data.result == 'ok') {
     document.getElementById('depositLabel').innerHTML = 'Success';
     return;
  }

  document.getElementById('depositLabel').innerHTML = 'Error: ' + data.error;
}

</script>  

<body>
	
	    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#">Laundromat</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li class="active"><a href="#">Main</a></li>
            <li><a href="new.html">New</a></li>
            <li><a href="withdraw.html">Withdraw</a></li>
            <li><a href="help.html">Help</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>


  <section id="container" class=" container">
	  <div class="row">
		<div class="col-sm-12">
	  <div class="jumbotron">
        <h1>Laundromat</h1>
        <p>Ethereum Mixing Service</p>
    </div>
      
    <div class="page-header">
        <h1>Main</h1>
    </div>  
    
    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">Private Key</h3>
      </div>
      <div class="panel-body">
        <p>A private key is necessary to participate in a mixing contract. Click "Generate" to generate a private key, and then <i>write it down</i>. If you lose your private key, you will not be able to recover your Ether after mixing.</p>
		    <form>
				    <div class="input-group">
              <span class="input-group-btn">
                <button class="btn btn-info" type="button" name="Generate" value="Generate" onclick="generatePrivate()">Generate Key</button>
              </span>
              <input type="text" class="form-control" id="privateResult" name="privateResult">
            </div>
		    </form>
      </div>
    </div>

    <div class="panel panel-default">
            <div class="panel-heading">
              <h3 class="panel-title">Check Contract Status</h3>
            </div>
            <div class="panel-body">
	            <p>Enter the address of a mixing contract to display its status.</p>
	            <p>If the number of participants is lower than the participant limit, you may join the contract. The "Payment" is the amount of Ether you need to deposit in order to participate in the contract.</p>
			        <div id="queryStatusLabel" class="text-warning"></div>
					    <form>
							    <div class="input-group">
			              <span class="input-group-btn">
			                <button class="btn btn-info" type="button" name="Status" value="Status" onclick="getStatus(document.getElementById('address').value, statusCallback)">Check Status</button>
			              </span>
			              <input type="text" class="form-control" id="address">
			            </div>
					    </form>
            </div>
    </div>


    <div class="panel panel-default">
            <div class="panel-heading">
              <h3 class="panel-title">Contract Status</h3>
            </div>
            <div class="panel-body">
				      <div class="bs-component">
				        <ul class="nav nav-pills">
				          <li class="active"><a href="#">Participant Limit:&nbsp;&nbsp;<span class="badge_large"><div name="participants" id="participants">--</div></span></a></li>
				          <li class="active"><a href="#">Number of Participants:&nbsp;&nbsp;<span class="badge_large"><div name="gotParticipants" id="gotParticipants">--</div></span></a></li>
				          <li class="active"><a href="#">Payment (ETH):&nbsp;&nbsp;<span class="badge_large"><div name="payment" id="payment">--</div></span></a></li>
				        </ul>
				      </div>
            </div>
            <div class="panel-footer">
	            <p>Enter your Ethereum address below in order to join this contract. The "Payment" amount will be deducted from your account. Your account must be unlocked, see Help for details on how to do this. </p>
					    <form>
							    <div class="input-group">
			              <span class="input-group-btn">
			                <button class="btn btn-success" type="button" name="join" value="join" onclick="depositStart()">Join Contract</button>
			              </span>
			              <input type="text" class="form-control" id="myaddress" name="myaddress">
			            </div>
					    </form>
      			</div>
    </div>
    
    
<br /><br />



	  </div>
	  </div>
  </section>
  <!--main content end-->

  <!-- js placed at the end of the document so the pages load faster -->
  <script src="web3.js"></script>
  <script type="text/javascript" src="jsbn.js"></script>
  <script type="text/javascript" src="signer.js"></script>
  <script type="text/javascript" src="laundromat.js"></script>

</body>
</html>